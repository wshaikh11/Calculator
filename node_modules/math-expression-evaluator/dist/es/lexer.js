"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("./token");function t(e,t){for(var n=0;n<e.length;n++)e[n]+=t;return e}var n={0:!0,1:!0,3:!0,4:!0,6:!0,8:!0,9:!0,12:!0,13:!0,14:!0},r={0:!0,1:!0,2:!0,3:!0,4:!0,5:!0,6:!0,7:!0,8:!0,9:!0,10:!0,11:!0,12:!0,13:!0},s={0:!0,3:!0,4:!0,8:!0,12:!0,13:!0},h={},o={0:!0,1:!0,3:!0,4:!0,6:!0,8:!0,12:!0,13:!0},p={1:!0},u=[[],["1","2","3","7","8","9","4","5","6","+","-","*","/","(",")","^","!","P","C","e","0",".",",","n"," ","&"],["pi","ln","Pi"],["sin","cos","tan","Del","int","Mod","log","pow"],["asin","acos","atan","cosh","root","tanh","sinh"],["acosh","atanh","asinh","Sigma"]];function a(e,t,n,r){for(var s=0;s<r;s++)if(e[n+s]!==t[s])return!1;return!0}function i(e,t){for(var n=0;n<t.length;n++)if(t[n].token===e)return n;return-1}exports.addToken=function(t){for(var n=0;n<t.length;n++){var r=t[n].token.length,s=-1;t[n].type===e.tokenTypes.FUNCTION_WITH_N_ARGS&&void 0===t[n].numberOfArguments&&(t[n].numberOfArguments=2),u[r]=u[r]||[];for(var h=0;h<u[r].length;h++)if(t[n].token===u[r][h]){s=i(u[r][h],this.tokens);break}-1===s?(this.tokens.push(t[n]),t[n].precedence=e.preced[t[n].type],u.length<=t[n].token.length&&(u[t[n].token.length]=[]),u[t[n].token.length].push(t[n].token)):(this.tokens[s]=t[n],t[n].precedence=e.preced[t[n].type])}},exports.lex=function(e,l){var f,c={value:this.math.changeSign,type:0,precedence:4,show:"-"},g={value:")",show:")",type:5,precedence:0},d={value:"(",type:4,precedence:0,show:"("},v=[d],w=[],y=e,m=n,k=0,b=h,O="";void 0!==l&&this.addToken(l);var x=function(e,t){for(var n,r,s,h=[],o=t.length,p=0;p<o;p++)if(!(p<o-1&&" "===t[p]&&" "===t[p+1])){for(n="",r=t.length-p>u.length-2?u.length-1:t.length-p;r>0;r--)if(void 0!==u[r])for(s=0;s<u[r].length;s++)a(t,u[r][s],p,r)&&(n=u[r][s],s=u[r].length,r=0);if(p+=n.length-1,""===n)throw new Error("Can't understand after "+t.slice(p));h.push(e.tokens[i(n,e.tokens)])}return h}(this,y);for(f=0;f<x.length;f++){var A=x[f];if(14!==A.type){var E,T=A.token,_=A.type,C=A.value,S=A.precedence,D=A.show,N=v[v.length-1];for(E=w.length;E--&&0===w[E];)if(-1!==[0,2,3,4,5,9,10,11,12,13].indexOf(_)){if(!0!==m[_])throw new Error(T+" is not allowed after "+O);v.push(g),m=r,b=o,w.pop()}if(!0!==m[_])throw new Error(T+" is not allowed after "+O);!0===b[_]&&(_=2,C=this.math.mul,D="&times;",S=3,f-=1);var P={value:C,type:_,precedence:S,show:D,numberOfArguments:A.numberOfArguments};if(0===_)m=n,b=h,t(w,2),v.push(P),4!==x[f+1].type&&(v.push(d),w.push(2));else if(1===_)1===N.type?(N.value+=C,t(w,1)):v.push(P),m=r,b=s;else if(2===_)m=n,b=h,t(w,2),v.push(P);else if(3===_)v.push(P),m=r,b=o;else if(4===_)t(w,1),k++,m=n,b=h,v.push(P);else if(5===_){if(!k)throw new Error("Closing parenthesis are more than opening one, wait What!!!");k--,m=r,b=o,v.push(P),t(w,1)}else if(6===_){if(N.hasDec)throw new Error("Two decimals are not allowed in one number");1!==N.type&&(N={show:"0",value:0,type:1,precedence:0},v.push(N)),m=p,t(w,1),b=h,N.value+=C,N.hasDec=!0}else 7===_&&(m=r,b=o,t(w,1),v.push(P));8===_?(m=n,b=h,t(w,A.numberOfArguments+2),v.push(P),4!==x[f+1].type&&(v.push(d),w.push(A.numberOfArguments+2))):9===_?(9===N.type?N.value===this.math.add?(N.value=C,N.show=D,t(w,1)):N.value===this.math.sub&&"-"===D&&(N.value=this.math.add,N.show="+",t(w,1)):5!==N.type&&7!==N.type&&1!==N.type&&3!==N.type&&13!==N.type?"-"===T&&(m=n,b=h,t(w,2).push(2),v.push(c),v.push(d)):(v.push(P),t(w,2)),m=n,b=h):10===_?(m=n,b=h,t(w,2),v.push(P)):11===_?(m=n,b=h,v.push(P)):12===_?(m=n,b=h,t(w,6),v.push(P),4!==x[f+1].type&&(v.push(d),w.push(6))):13===_&&(m=r,b=o,v.push(P)),t(w,-1),O=T}else if(f>0&&f<x.length-1&&1===x[f+1].type&&(1===x[f-1].type||6===x[f-1].type))throw new Error("Unexpected Space")}for(E=w.length;E--;)v.push(g);if(!0!==m[5])throw new Error("complete the expression");for(;k--;)v.push(g);return v.push(g),v};
